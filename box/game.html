<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é»‘é‡‘å¸å›½Â·é…’å§äº‰å¤ºæˆ˜</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #0a0a0a;
            color: #fff;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            height: 100vh;
        }
        
        .app-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .status-bar {
            height: 80px;
            background: linear-gradient(to bottom, #1a1a1a, #000);
            border-bottom: 2px solid #D4AF37;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #D4AF37, #8B0000);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #000;
            font-size: 20px;
            border: 3px solid #8B0000;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .player-stats {
            font-size: 14px;
            min-width: 0;
        }
        
        .player-name {
            font-weight: bold;
            color: #D4AF37;
            font-size: 18px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-faction-badge {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(139, 0, 0, 0.5);
            border-radius: 10px;
            font-size: 11px;
            color: #D4AF37;
            margin-left: 5px;
        }
        
        .leader-badge {
            display: inline-block;
            padding: 2px 8px;
            background: linear-gradient(to bottom, #D4AF37, #9e7c20);
            border-radius: 10px;
            font-size: 11px;
            color: #000;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .player-resources {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        
        .resource {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .resource i {
            color: #D4AF37;
            font-size: 18px;
        }
        
        .resource-value {
            font-weight: bold;
        }
        
        /* æ¸¸æˆè®¡æ—¶å™¨ */
        .game-timer {
            font-size: 20px;
            color: #8B0000;
            text-shadow: 0 0 10px rgba(139, 0, 0, 0.5);
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow: hidden;
            position: relative;
            min-height: 0;
        }
        
        /* é¡µé¢å®¹å™¨ */
        .page {
            display: none;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        .page.active {
            display: block;
        }
        
        .page-content {
            padding: 15px;
            min-height: 100%;
        }
        
        /* æ¬¢è¿é¡µé¢ */
        .welcome-screen {
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)),
                        url('https://images.unsplash.com/photo-1513104890138-7c749659a591?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') center/cover;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .logo {
            font-size: 48px;
            color: #D4AF37;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.9);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 20px;
            color: #8B0000;
            margin-bottom: 40px;
        }
        
        .btn {
            background: linear-gradient(to bottom, #D4AF37, #9e7c20);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.5);
        }
        
        /* æ€§åˆ«é€‰æ‹© */
        .gender-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
        }
        
        .gender-card {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #D4AF37;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            width: 140px;
        }
        
        .gender-card.selected {
            background: rgba(212, 175, 55, 0.2);
            border-color: #8B0000;
        }
        
        .gender-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .gender-name {
            font-size: 18px;
            font-weight: bold;
            color: #D4AF37;
        }
        
        /* é˜µè¥é€‰æ‹© */
        .faction-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .faction-card {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #D4AF37;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            position: relative;
        }
        
        .faction-card.selected {
            border-color: #8B0000;
            background: rgba(139, 0, 0, 0.2);
        }
        
        .faction-icon {
            font-size: 30px;
            color: #D4AF37;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .faction-name {
            font-size: 18px;
            font-weight: bold;
            color: #D4AF37;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .faction-desc {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .faction-skill {
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .skill-title {
            font-weight: bold;
            color: #D4AF37;
            margin-bottom: 5px;
        }
        
        .skill-desc {
            font-size: 12px;
            color: #ccc;
        }
        
        .leader-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }
        
        .toggle-label {
            font-size: 16px;
            color: #D4AF37;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #8B0000;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: #D4AF37;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #00c853;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* åå­—è¾“å…¥ */
        .name-input {
            width: 100%;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border: 2px solid #D4AF37;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* å¤´åƒé€‰æ‹© */
        .avatar-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .avatar-option {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid #D4AF37;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
        }
        
        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #333;
            margin: 0 auto 15px;
            border: 3px solid #D4AF37;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        /* äºŒç»´ç æ‰«æ */
        .qr-container {
            max-width: 350px;
            margin: 0 auto;
            text-align: center;
            width: 100%;
        }
        
        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            background: #fff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qr-instruction {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        /* æ¸¸æˆå¤§å… */
        .dashboard-container {
            padding: 15px;
        }
        
        .team-info {
            background: rgba(139, 0, 0, 0.2);
            border: 2px solid #8B0000;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .team-title {
            font-size: 18px;
            color: #D4AF37;
            margin-bottom: 10px;
        }
        
        .team-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .team-stat {
            background: rgba(0,0,0,0.3);
            border: 1px solid #D4AF37;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #D4AF37;
        }
        
        /* ä»»åŠ¡å¤§å… */
        .task-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .task-category {
            padding: 8px 15px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #D4AF37;
            border-radius: 20px;
            font-size: 14px;
            color: #999;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .task-category.active {
            background: #D4AF37;
            color: #000;
            font-weight: bold;
        }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .task-card {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #D4AF37;
            border-radius: 10px;
            padding: 15px;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-name {
            font-weight: bold;
            font-size: 16px;
            color: #D4AF37;
        }
        
        .task-type {
            font-size: 12px;
            background: rgba(139, 0, 0, 0.3);
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .task-desc {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 10px;
        }
        
        .task-reward {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #D4AF37;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        /* ç‰¹æ®Šèƒ½åŠ› */
        .ability-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .ability-card {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #D4AF37;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
        }
        
        .ability-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: #D4AF37;
        }
        
        .ability-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .ability-cost {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            color: #D4AF37;
            margin-bottom: 10px;
        }
        
        /* å…³ç³»é¡µé¢ - æ–°å¢æ ·å¼ */
        .relation-page {
            padding: 15px;
        }
        
        .relation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .relation-title {
            font-size: 28px;
            color: #D4AF37;
        }
        
        .relation-filters {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 15px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #D4AF37;
            border-radius: 20px;
            font-size: 14px;
            color: #999;
            cursor: pointer;
        }
        
        .filter-btn.active {
            background: #D4AF37;
            color: #000;
            font-weight: bold;
        }
        
        .relation-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .relation-card {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #D4AF37;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .relation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #D4AF37, #8B0000);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .relation-info {
            flex: 1;
            min-width: 0;
        }
        
        .relation-name {
            font-weight: bold;
            font-size: 16px;
            color: #D4AF37;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .relation-type {
            font-size: 12px;
            background: rgba(139, 0, 0, 0.3);
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .relation-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(212, 175, 55, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background: rgba(212, 175, 55, 0.4);
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            height: 70px;
            background: linear-gradient(to top, #1a1a1a, #000);
            border-top: 2px solid #D4AF37;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            position: relative;
            flex: 1;
            max-width: 80px;
        }
        
        .nav-item.active {
            color: #D4AF37;
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: #D4AF37;
            border-radius: 3px;
        }
        
        .nav-item i {
            font-size: 24px;
        }
        
        .nav-item span {
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            text-align: center;
        }
        
        .scan-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(to bottom, #D4AF37, #9e7c20);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.7);
            transform: translateY(-10px);
            flex-shrink: 0;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #1a1a1a;
            border: 3px solid #D4AF37;
            border-radius: 20px;
            padding: 25px;
            max-width: 380px;
            width: 100%;
            text-align: center;
        }
        
        .modal-title {
            font-size: 22px;
            color: #D4AF37;
            margin-bottom: 15px;
        }
        
        /* é”™è¯¯æç¤º */
        .error-hint {
            color: #ff6b6b;
            font-size: 13px;
            margin-top: -15px;
            margin-bottom: 15px;
            display: none;
        }
        
        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .btn-secondary {
            background: linear-gradient(to bottom, #8B0000, #5a0000);
            color: #D4AF37;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .btn-ability {
            background: linear-gradient(to bottom, #8B0000, #5a0000);
            color: #D4AF37;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            margin-top: 5px;
            width: 100%;
        }
        
        .btn-ability:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .warning-text {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }
        
        /* ç…§ç‰‡æ¨¡æ€æ¡† */
        .photo-modal-content {
            background: #1a1a1a;
            border: 3px solid #D4AF37;
            border-radius: 20px;
            padding: 15px;
            max-width: 90%;
            width: 100%;
            text-align: center;
        }
        
        .member-photo {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 20px;
            max-height: 70vh;
            object-fit: cover;
        }
        
        .photo-details {
            text-align: left;
            margin-bottom: 20px;
        }
        
        .photo-name {
            font-size: 22px;
            color: #D4AF37;
            margin-bottom: 10px;
        }
        
        .photo-title {
            font-size: 16px;
            color: #ccc;
            margin-bottom: 5px;
        }
        
        .photo-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .online-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #00c853;
            display: inline-block;
        }
        
        .offline-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ff6b6b;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
        <div class="status-bar" id="statusBar" style="display: none;">
            <div class="player-info">
                <div class="player-avatar" id="playerAvatar">A</div>
                <div class="player-stats">
                    <div class="player-name">
                        <span id="playerName">ç©å®¶</span>
                        <span class="player-faction-badge" id="factionBadge">é»‘å¸®</span>
                        <span class="leader-badge" id="leaderBadge" style="display:none;">å¸®ä¸»</span>
                    </div>
                    <div class="player-resources">
                        <div class="resource">
                            <i class="ri-coin-line"></i>
                            <span class="resource-value" id="playerCoins">1000</span>
                        </div>
                        <div class="resource">
                            <i class="ri-bar-chart-line"></i>
                            <span class="resource-value" id="playerStock">5</span>%
                        </div>
                    </div>
                </div>
            </div>
            <div class="top-controls">
                <div class="game-timer" id="gameTimer">02:59:59</div>
                <button class="btn btn-small" id="factionSkillBtn" style="display:none;">
                    <i class="ri-sword-line"></i> é˜µè¥æŠ€èƒ½
                </button>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- æ¬¢è¿é¡µé¢ -->
            <div class="page active" id="welcomePage">
                <div class="welcome-screen">
                    <div>
                        <h1 class="logo">é»‘é‡‘å¸å›½</h1>
                        <p class="subtitle">é…’å§äº‰å¤ºæˆ˜</p>
                        <p style="font-size: 14px; margin-bottom: 30px; color: #ccc;">
                            1933 Â· ç¦é…’ä»¤æ—¶ä»£çš„æƒåŠ›æ¸¸æˆ
                        </p>
                        <button class="btn" onclick="switchPage('genderPage')">å¼€å§‹æ¸¸æˆ</button>
                    </div>
                </div>
            </div>
            
            <!-- æ€§åˆ«é€‰æ‹© -->
            <div class="page" id="genderPage">
                <div style="width: 100%; max-width: 350px; margin: 0 auto; text-align: center;">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px;">é€‰æ‹©æ€§åˆ«</h2>
                    
                    <div class="gender-selection">
                        <div class="gender-card" onclick="selectGender('male', this)">
                            <div class="gender-icon">â™‚ï¸</div>
                            <div class="gender-name">ç”·æ€§</div>
                        </div>
                        
                        <div class="gender-card" onclick="selectGender('female', this)">
                            <div class="gender-icon">â™€ï¸</div>
                            <div class="gender-name">å¥³æ€§</div>
                        </div>
                    </div>
                    
                    <div class="error-hint" id="genderHint">è¯·é€‰æ‹©æ€§åˆ«</div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="switchPage('welcomePage')">è¿”å›</button>
                        <button class="btn" onclick="confirmGender()">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
            
            <!-- é˜µè¥é€‰æ‹© -->
            <div class="page" id="factionPage">
                <div style="width: 100%; max-width: 400px; margin: 0 auto;">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px; text-align: center;">é€‰æ‹©é˜µè¥</h2>
                    
                    <div class="faction-grid">
                        <div class="faction-card" onclick="selectFaction('gang', this)">
                            <div class="faction-icon">ğŸ”«</div>
                            <div class="faction-name">é»‘å¸®</div>
                            <div class="faction-desc">åœ°ä¸‹ä¸–ç•Œçš„æŒæ§è€…</div>
                            <div class="faction-skill">
                                <div class="skill-title">å¼ºè¡Œæ”¹å˜å¯¹å†³ç»“æœ</div>
                                <div class="skill-desc">å½“æœ¬é˜µè¥ç©å®¶å‚ä¸çš„ä¸ªäººå¯¹å†³ç»“æŸåç»“ç®—å‰ï¼Œå¸®ä¸»å¯ä»¥å¼ºè¡Œå°†ç»“æœä¿®æ”¹ä¸ºå¯¹æœ¬æ–¹æœ‰åˆ©ï¼ˆæœ€å¤š3æ¬¡ï¼‰</div>
                            </div>
                        </div>
                        
                        <div class="faction-card" onclick="selectFaction('politician', this)">
                            <div class="faction-icon">ğŸ©</div>
                            <div class="faction-name">æ”¿å®¢</div>
                            <div class="faction-desc">æƒåŠ›æ¸¸æˆçš„æ“çºµè€…</div>
                            <div class="faction-skill">
                                <div class="skill-title">å¼ºåˆ¶æ²¡æ”¶è´¢äº§</div>
                                <div class="skill-desc">å¸®ä¸»å¯ä»¥åœ¨ä»»æ„æ—¶é—´å‘åŠ¨æ­¤æŠ€èƒ½ï¼Œå¼ºåˆ¶æ²¡æ”¶æŸé˜µè¥å››åˆ†ä¹‹ä¸€è´¢äº§ï¼ˆä»…é™1æ¬¡ï¼‰</div>
                            </div>
                        </div>
                        
                        <div class="faction-card" onclick="selectFaction('smuggler', this)">
                            <div class="faction-icon">ğŸ“¦</div>
                            <div class="faction-name">èµ°ç§å•†</div>
                            <div class="faction-desc">åœ°ä¸‹ç»æµçš„æµé€šè€…</div>
                            <div class="faction-skill">
                                <div class="skill-title">é‡‘å¸æƒ©ç½šå‡åŠ</div>
                                <div class="skill-desc">å½“æœ¬é˜µè¥ç©å®¶é¢ä¸´é‡‘å¸å‡å°‘æ—¶ï¼Œå¸®ä¸»å¯ä»¥ä½¿è¯¥ç©å®¶æœ¬æ¬¡åº”æ‰£é‡‘å¸å‡å°‘ä¸€åŠï¼ˆæœ€å¤š3æ¬¡ï¼‰</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="leader-toggle">
                        <span class="toggle-label">æˆ‘æ„¿æ„æˆä¸ºå¸®ä¸»</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="willingToBeLeader">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="error-hint" id="factionHint">è¯·é€‰æ‹©é˜µè¥</div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="switchPage('genderPage')">ä¸Šä¸€æ­¥</button>
                        <button class="btn" onclick="confirmFaction()">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
            
            <!-- åå­—è¾“å…¥é¡µé¢ -->
            <div class="page" id="namePage">
                <div style="width: 100%; max-width: 350px; margin: 0 auto; text-align: center;">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px;">è¾“å…¥åå­—</h2>
                    
                    <p style="margin-bottom: 20px; color: #ccc; font-size: 14px;">ç»™ä½ çš„è§’è‰²èµ·ä¸ªåå­—å§ï¼</p>
                    <input type="text" class="name-input" id="nameInput" placeholder="è¾“å…¥ä½ çš„åå­—" maxlength="12">
                    
                    <div class="error-hint" id="nameHint">è¯·è¾“å…¥åå­—ï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰</div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="switchPage('factionPage')">ä¸Šä¸€æ­¥</button>
                        <button class="btn" onclick="confirmName()">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
            
            <!-- å¤´åƒé€‰æ‹©é¡µé¢ -->
            <div class="page" id="avatarPage">
                <div style="width: 100%; max-width: 350px; margin: 0 auto; text-align: center;">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px;">é€‰æ‹©å¤´åƒ</h2>
                    
                    <div class="avatar-preview" id="avatarPreview">ğŸ‘¤</div>
                    
                    <div class="avatar-options">
                        <div class="avatar-option" onclick="selectAvatar('default')">
                            <i class="ri-user-line"></i>
                            <div>ä½¿ç”¨é»˜è®¤å¤´åƒ</div>
                        </div>
                        <div class="avatar-option" onclick="selectAvatar('upload')">
                            <i class="ri-upload-cloud-2-line"></i>
                            <div>ä»ç›¸å†Œä¸Šä¼ </div>
                        </div>
                    </div>
                    
                    <div class="error-hint" id="avatarHint">è¯·é€‰æ‹©å¤´åƒ</div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="switchPage('namePage')">ä¸Šä¸€æ­¥</button>
                        <button class="btn" onclick="confirmAvatar()">ä¸‹ä¸€æ­¥</button>
                    </div>
                </div>
            </div>
            
            <!-- äºŒç»´ç æ‰«æé¡µé¢ -->
            <div class="page" id="qrPage">
                <div class="qr-container">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px;">æ‰«ææ¡Œé¢äºŒç»´ç </h2>
                    
                    <p class="qr-instruction">
                        è¯·æ‰«ææ‚¨æ‰€åœ¨æ¡Œé¢çš„äºŒç»´ç ï¼Œä»¥ä¾¿ç³»ç»Ÿç¡®è®¤æ‚¨çš„ä½ç½®ã€‚<br>
                        è¿™å°†å¸®åŠ©æˆ‘ä»¬ä¸ºæ‚¨æä¾›æ›´å¥½çš„ç¤¾äº¤ä½“éªŒã€‚
                    </p>
                    
                    <div class="qr-code">
                        <!-- äºŒç»´ç å ä½ç¬¦ -->
                        <div style="color: #000; font-size: 14px;">æ¡Œå·äºŒç»´ç </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="switchPage('avatarPage')">ä¸Šä¸€æ­¥</button>
                        <button class="btn" onclick="confirmQRCode()">å·²å®Œæˆæ‰«æ</button>
                    </div>
                </div>
            </div>
            
            <!-- æ¸¸æˆå¤§å… -->
            <div class="page" id="dashboardPage">
                <div class="dashboard-container">
                    <div class="team-info">
                        <div class="team-title">5å·æ¡Œ Â· é»‘å¸®é˜µè¥</div>
                        <div class="team-stats">
                            <div class="team-stat">
                                <div class="stat-label">å›¢é˜Ÿé‡‘å¸æ€»å€¼</div>
                                <div class="stat-value">12,450</div>
                            </div>
                            <div class="team-stat">
                                <div class="stat-label">å›¢é˜Ÿæ´»è·ƒåº¦</div>
                                <div class="stat-value">87%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="color: #D4AF37; font-size: 16px; margin-bottom: 10px;">æ‰€æœ‰æ¡Œå·å›¢é˜Ÿ</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div style="background: rgba(26,26,26,0.9); border: 2px solid #D4AF37; border-radius: 10px; padding: 15px; text-align: center;">
                            <div style="font-size: 24px; color: #D4AF37; margin-bottom: 5px;">1å·æ¡Œ</div>
                            <div style="font-size: 12px; color: #ccc;">é‡‘å¸: 8,500</div>
                        </div>
                        <div style="background: rgba(26,26,26,0.9); border: 2px solid #D4AF37; border-radius: 10px; padding: 15px; text-align: center;">
                            <div style="font-size: 24px; color: #D4AF37; margin-bottom: 5px;">2å·æ¡Œ</div>
                            <div style="font-size: 12px; color: #ccc;">é‡‘å¸: 9,200</div>
                        </div>
                        <div style="background: rgba(26,26,26,0.9); border: 2px solid #D4AF37; border-radius: 10px; padding: 15px; text-align: center;">
                            <div style="font-size: 24px; color: #D4AF37; margin-bottom: 5px;">3å·æ¡Œ</div>
                            <div style="font-size: 12px; color: #ccc;">é‡‘å¸: 12,450</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ä»»åŠ¡å¤§å… -->
            <div class="page" id="taskPage">
                <div class="page-content">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px; text-align: center;">ä»»åŠ¡å¤§å…</h2>
                    
                    <div class="task-categories">
                        <div class="task-category active">å…¨éƒ¨ä»»åŠ¡</div>
                        <div class="task-category">çº¿ä¸Šå¯¹å†³</div>
                        <div class="task-category">çº¿ä¸‹ä»»åŠ¡</div>
                    </div>
                    
                    <div class="task-list">
                        <div class="task-card">
                            <div class="task-header">
                                <div class="task-name">çŸ³å¤´å‰ªå­å¸ƒå¯¹å†³</div>
                                <div class="task-type">çº¿ä¸Š</div>
                            </div>
                            <div class="task-desc">æ”¯ä»˜100é‡‘å¸å‚ä¸å¯¹å†³ï¼Œè·èƒœå¯è·å¾—200é‡‘å¸</div>
                            <div class="task-reward">
                                <i class="ri-coin-line"></i> 200é‡‘å¸
                            </div>
                            <button class="btn" style="width: 100%;">å¼€å§‹å¯¹å†³</button>
                        </div>
                        
                        <div class="task-card">
                            <div class="task-header">
                                <div class="task-name">æ‘‡éª°å­æ¯”å¤§å°</div>
                                <div class="task-type">çº¿ä¸Š</div>
                            </div>
                            <div class="task-desc">æ”¯ä»˜100é‡‘å¸å‚ä¸å¯¹å†³ï¼Œè·èƒœå¯è·å¾—200é‡‘å¸</div>
                            <div class="task-reward">
                                <i class="ri-coin-line"></i> 200é‡‘å¸
                            </div>
                            <button class="btn" style="width: 100%;">å¼€å§‹å¯¹å†³</button>
                        </div>
                        
                        <div class="task-card">
                            <div class="task-header">
                                <div class="task-name">å¯»æ‰¾å¼‚æ€§åˆå½±</div>
                                <div class="task-type">çº¿ä¸‹</div>
                            </div>
                            <div class="task-desc">æ‰¾åˆ°ä¸€ä½å¼‚æ€§ç©å®¶å¹¶å®Œæˆè´´è„¸åˆå½±</div>
                            <div class="task-reward">
                                <i class="ri-coin-line"></i> 200é‡‘å¸
                            </div>
                            <button class="btn" style="width: 100%;">æ¥å—ä»»åŠ¡</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç‰¹æ®Šèƒ½åŠ› -->
            <div class="page" id="abilityPage">
                <div class="page-content">
                    <h2 style="font-size: 28px; color: #D4AF37; margin-bottom: 20px; text-align: center;">ç‰¹æ®Šèƒ½åŠ›</h2>
                    <p style="text-align: center; margin-bottom: 20px; color: #ccc;">ä½¿ç”¨é‡‘å¸è´­ä¹°å¼ºå¤§æŠ€èƒ½</p>
                    
                    <div class="ability-grid" id="abilityGrid">
                        <!-- èƒ½åŠ›å¡ç‰‡ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å…³ç³»é¡µé¢ - æ›¿æ¢åŸå•†åº—é¡µé¢ -->
            <div class="page" id="relationPage">
                <div class="relation-page">
                    <div class="relation-header">
                        <h2 class="relation-title">å¸®æ´¾å…³ç³»</h2>
                        <div class="relation-filters">
                            <div class="filter-btn active">å…¨éƒ¨</div>
                            <div class="filter-btn">å®¶æ—</div>
                            <div class="filter-btn">æ ¸å¿ƒæˆå‘˜</div>
                        </div>
                    </div>
                    
                    <div class="relation-list" id="relationList">
                        <!-- å¸®æ´¾æˆå‘˜åˆ—è¡¨ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav" id="bottomNav" style="display: none;">
            <div class="nav-item active" onclick="switchPage('dashboardPage', this)">
                <i class="ri-home-4-line"></i>
                <span>å¤§å…</span>
            </div>
            <div class="nav-item" onclick="switchPage('taskPage', this)">
                <i class="ri-todo-line"></i>
                <span>ä»»åŠ¡</span>
            </div>
            <div class="scan-btn" onclick="scanQRCode()">
                <i class="ri-qr-scan-line"></i>
            </div>
            <div class="nav-item" onclick="switchPage('abilityPage', this)">
                <i class="ri-flashlight-line"></i>
                <span>èƒ½åŠ›</span>
            </div>
            <div class="nav-item" onclick="switchPage('relationPage', this)">
                <i class="ri-group-line"></i>
                <span>å…³ç³»</span>
            </div>
        </div>
    </div>
    
    <!-- æŠ€èƒ½ç¡®è®¤å¼¹çª— -->
    <div class="modal" id="skillModal">
        <div class="modal-content">
            <h3 class="modal-title" id="skillTitle">å‘åŠ¨é˜µè¥æŠ€èƒ½</h3>
            <p id="skillDescription" style="margin-bottom: 20px; line-height: 1.5;">æŠ€èƒ½æè¿°å†…å®¹...</p>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" style="flex:1;" onclick="closeModal('skillModal')">å–æ¶ˆ</button>
                <button class="btn" style="flex:1;" id="confirmSkillBtn">ç¡®è®¤å‘åŠ¨</button>
            </div>
        </div>
    </div>
    
    <!-- ç…§ç‰‡æŸ¥çœ‹å¼¹çª— -->
    <div class="modal" id="photoModal">
        <div class="photo-modal-content">
            <img class="member-photo" id="memberPhoto" src="" alt="æˆå‘˜ç…§ç‰‡">
            <div class="photo-details">
                <div class="photo-name" id="photoName">æ‰˜å°¼Â·ç´¢æ™®æ‹‰è¯º</div>
                <div class="photo-title" id="photoTitle">å¸®æ´¾å‰¯æ‰‹</div>
                <div class="photo-status" id="photoStatus">
                    <span class="online-dot"></span> åœ¨çº¿
                </div>
            </div>
            <button class="btn" onclick="closeModal('photoModal')">è¿”å›</button>
        </div>
    </div>
    
    <!-- ç§èŠå¼¹çª— -->
    <div class="modal" id="chatModal">
        <div class="modal-content">
            <h3 class="modal-title">ä¸ <span id="chatTarget">æ‰˜å°¼Â·ç´¢æ™®æ‹‰è¯º</span> ç§èŠ</h3>
            <div style="height: 300px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #D4AF37; border-radius: 10px; padding: 10px; background: rgba(0,0,0,0.3);" id="chatHistory">
                <!-- èŠå¤©è®°å½• -->
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" placeholder="è¾“å…¥æ¶ˆæ¯..." style="flex:1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid #D4AF37; border-radius: 10px; color: #fff;">
                <button class="btn">å‘é€</button>
            </div>
            <button class="btn btn-secondary" style="margin-top: 15px; width: 100%;" onclick="closeModal('chatModal')">å…³é—­</button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            player: {
                gender: null,
                faction: null,
                isLeader: false,
                name: '',
                avatar: 'ğŸ‘¤',
                coins: 1000,
                stock: 5,
                tableNumber: null,
                skills: []
            },
            currentPage: 'welcomePage',
            selectedGender: null,
            selectedFaction: null,
            selectedDrink: null,
            selectedAbility: null,
            
            // å¸®æ´¾æˆå‘˜æ•°æ®
            gangMembers: [
                {
                    id: 'm1',
                    name: 'æ‰˜å°¼Â·ç´¢æ™®æ‹‰è¯º',
                    avatar: 'ğŸ‘¨â€ğŸ’¼',
                    relation: 'å‰¯æ‰‹',
                    title: 'å¸®æ´¾å‰¯æ‰‹',
                    online: true,
                    photo: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80'
                },
                {
                    id: 'm2',
                    name: 'å¡æ¢…æ‹‰Â·ç´¢æ™®æ‹‰è¯º',
                    avatar: 'ğŸ‘©â€ğŸ¦°',
                    relation: 'å¦»å­',
                    title: 'å¸®æ´¾å¤«äºº',
                    online: true,
                    photo: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'
                },
                {
                    id: 'm3',
                    name: 'ä¿åˆ©Â·æ²ƒå°”çº³ç‰¹',
                    avatar: 'ğŸ‘¨â€ğŸ¦±',
                    relation: 'å…„å¼Ÿ',
                    title: 'æ ¸å¿ƒæˆå‘˜',
                    online: true,
                    photo: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80'
                },
                {
                    id: 'm4',
                    name: 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è«å°”è’‚æ¡‘è’‚',
                    avatar: 'ğŸ‘¨â€ğŸ¤',
                    relation: 'è¡¨å¼Ÿ',
                    title: 'æ‰“æ‰‹',
                    online: false,
                    photo: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80'
                },
                {
                    id: 'm5',
                    name: 'è¥¿å°”ç»´å¥¥Â·ä½†ä¸',
                    avatar: 'ğŸ‘¨â€ğŸ’¼',
                    relation: 'é¡¾é—®',
                    title: 'å†›å¸ˆ',
                    online: true,
                    photo: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1964&q=80'
                },
                {
                    id: 'm6',
                    name: 'è²æ¯”Â·æ‹‰Â·ç›–äºš',
                    avatar: 'ğŸ‘©â€ğŸ¦±',
                    relation: 'å§å§',
                    title: 'å®¶æ—æˆå‘˜',
                    online: false,
                    photo: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80'
                },
                {
                    id: 'm7',
                    name: 'è²å°”æ–¯Â·é›·æ¬§å¡”',
                    avatar: 'ğŸ§”â€â™‚ï¸',
                    relation: 'å”å”',
                    title: 'é•¿è€',
                    online: true,
                    photo: 'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80'
                },
                {
                    id: 'm8',
                    name: 'é˜¿å¾·é‡Œäºšå¨œÂ·æ‹‰Â·å¡å°”ç“¦',
                    avatar: 'ğŸ‘©â€ğŸ¦³',
                    relation: 'çº¿äºº',
                    title: 'æƒ…æŠ¥å‘˜',
                    online: true,
                    photo: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1888&q=80'
                }
            ],
            
            // å¯ç”¨æŠ€èƒ½æ± 
            skills: [
                { id: 's1', name: 'é»„é‡‘è°ƒé…’', desc: 'è´­ä¹°é…’æ°´æ—¶è·å¾—é¢å¤–æŠ€èƒ½åŠ æˆ', price: 300 },
                { id: 's2', name: 'è‚¡å¸‚æ´å¯Ÿ', desc: 'è‚¡ç¥¨äº¤æ˜“æ”¶ç›Šå¢åŠ 20%', price: 400 },
                { id: 's3', name: 'è°ˆåˆ¤ä¸“å®¶', desc: 'è°ˆåˆ¤æˆåŠŸç‡æé«˜30%', price: 350 },
                { id: 's4', name: 'ç­–ç•¥å¸ƒå±€', desc: 'æ¯æ¬¡è¡ŒåŠ¨æœ‰å‡ ç‡è·å¾—é¢å¤–é‡‘å¸', price: 250 },
                { id: 's5', name: 'è´¢å¯Œè½¬ç§»', desc: 'ç›´æ¥è·å¾—ç›®æ ‡ç©å®¶300é‡‘å¸', price: 450 },
                { id: 's6', name: 'ç¤¾äº¤é­…åŠ›', desc: 'ç¤¾äº¤äº’åŠ¨æ”¶ç›Šå¢åŠ 25%', price: 320 },
                { id: 's7', name: 'æš—å½±è¡ŒåŠ¨', desc: 'å¤œé—´è¡ŒåŠ¨ä¸ä¼šè¢«å‘ç°', price: 380 },
                { id: 's8', name: 'åŒå€æ”¶ç›Š', desc: 'ä¸‹ä¸€æ¬¡ä»»åŠ¡å¥–åŠ±ç¿»å€', price: 420 }
            ],
            
            // å¯è´­ä¹°çš„ç‰¹æ®Šèƒ½åŠ›
            purchasableAbilities: [
                {
                    id: 'a1',
                    name: 'é’èƒ½åŠ›',
                    icon: 'ğŸ’¸',
                    desc: 'æ”¯ä»˜é‡‘å¸è·å¾—è‚¡æƒ',
                    price: 500,
                    effect: 'ç«‹å³è·å¾—5%é…’å§è‚¡æƒ'
                },
                {
                    id: 'a2',
                    name: 'ç¬èƒ½åŠ›',
                    icon: 'âš¡',
                    desc: 'ç«‹å³è·å¾—ä¼˜åŠ¿',
                    price: 300,
                    effect: 'ä¸‹ä¸€æ¬¡ä»»åŠ¡å¥–åŠ±å¢åŠ 50%'
                },
                {
                    id: 'a3',
                    name: 'æƒ…æŠ¥ç½‘',
                    icon: 'ğŸ“¡',
                    desc: 'è·å–å¯¹æ‰‹ä¿¡æ¯',
                    price: 400,
                    effect: 'æŸ¥çœ‹ä»»æ„å¯¹æ‰‹çš„é‡‘å¸å’Œè‚¡æƒ'
                },
                {
                    id: 'a4',
                    name: 'æ—¶é—´æ‰­æ›²',
                    icon: 'â³',
                    desc: 'å»¶é•¿æ¸¸æˆæ—¶é—´',
                    price: 600,
                    effect: 'ä¸ºå›¢é˜Ÿé¢å¤–è·å¾—15åˆ†é’Ÿæ¸¸æˆæ—¶é—´'
                }
            ]
        };
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(pageId).classList.add('active');
            gameState.currentPage = pageId;
            
            // æ›´æ–°å¯¼èˆªæ 
            if (pageId === 'dashboardPage' || pageId === 'taskPage' ||
                pageId === 'abilityPage' || pageId === 'relationPage') {
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeNav = Array.from(document.querySelectorAll('.nav-item')).find(item => {
                    return item.querySelector('span').textContent ===
                        (pageId === 'dashboardPage' ? 'å¤§å…' :
                         pageId === 'taskPage' ? 'ä»»åŠ¡' :
                         pageId === 'abilityPage' ? 'èƒ½åŠ›' : 'å…³ç³»');
                });
                
                if (activeNav) activeNav.classList.add('active');
            }
            
            // å¦‚æœæ˜¯å…³ç³»é¡µé¢ï¼Œç”Ÿæˆå¸®æ´¾æˆå‘˜åˆ—è¡¨
            if (pageId === 'relationPage') {
                generateGangRelations();
            }
            
            // å¦‚æœæ˜¯èƒ½åŠ›é¡µé¢ï¼Œç”Ÿæˆèƒ½åŠ›åˆ—è¡¨
            if (pageId === 'abilityPage') {
                generateAbilityList();
            }
        }
        
        // ç”Ÿæˆå¸®æ´¾å…³ç³»åˆ—è¡¨
        function generateGangRelations() {
            const list = document.getElementById('relationList');
            list.innerHTML = '';
            
            gameState.gangMembers.forEach(member => {
                const card = document.createElement('div');
                card.className = 'relation-card';
                
                card.innerHTML = `
                    <div class="relation-avatar" onclick="showMemberPhoto('${member.id}')">
                        ${member.avatar}
                    </div>
                    <div class="relation-info">
                        <div class="relation-name">${member.name}</div>
                        <div class="relation-type">${member.relation} Â· ${member.title}</div>
                    </div>
                    <div class="relation-actions">
                        <div class="action-btn" onclick="startChat('${member.id}')">
                            <i class="ri-message-2-line"></i>
                        </div>
                        <div class="action-btn" onclick="showMemberPhoto('${member.id}')">
                            <i class="ri-eye-line"></i>
                        </div>
                    </div>
                `;
                
                list.appendChild(card);
            });
        }
        
        // æ˜¾ç¤ºæˆå‘˜ç…§ç‰‡
        function showMemberPhoto(memberId) {
            const member = gameState.gangMembers.find(m => m.id === memberId);
            if (!member) return;
            
            document.getElementById('memberPhoto').src = member.photo;
            document.getElementById('photoName').textContent = member.name;
            document.getElementById('photoTitle').textContent = member.title;
            
            const statusElement = document.getElementById('photoStatus');
            statusElement.innerHTML = member.online ?
                '<span class="online-dot"></span> åœ¨çº¿' :
                '<span class="offline-dot"></span> ç¦»çº¿';
            
            document.getElementById('photoModal').classList.add('active');
        }
        
        // å¼€å§‹ç§èŠ
        function startChat(memberId) {
            const member = gameState.gangMembers.find(m => m.id === memberId);
            if (!member) return;
            
            document.getElementById('chatTarget').textContent = member.name;
            document.getElementById('chatHistory').innerHTML = `
                <div style="text-align: center; color: #999; margin: 10px 0;">
                    å¼€å§‹ä¸ ${member.name} çš„å¯¹è¯
                </div>
            `;
            
            document.getElementById('chatModal').classList.add('active');
        }
        
        // ç”Ÿæˆèƒ½åŠ›åˆ—è¡¨
        function generateAbilityList() {
            const grid = document.getElementById('abilityGrid');
            grid.innerHTML = '';
            
            gameState.purchasableAbilities.forEach(ability => {
                const card = document.createElement('div');
                card.className = 'ability-card';
                
                // æ£€æŸ¥ç©å®¶æ˜¯å¦å·²æ‹¥æœ‰æ­¤èƒ½åŠ›
                const hasAbility = gameState.player.skills.some(skill => skill.id === ability.id);
                
                card.innerHTML = `
                    <div class="ability-icon">${ability.icon}</div>
                    <div class="ability-name">${ability.name}</div>
                    <div class="ability-desc">${ability.desc}</div>
                    <div class="ability-cost">
                        <i class="ri-coin-line"></i> ${ability.price}é‡‘å¸
                    </div>
                    <div style="font-size: 12px; color: #ccc; margin-bottom: 10px;">
                        ${ability.effect}
                    </div>
                    <button class="btn-ability" ${hasAbility ? 'disabled' : ''} onclick="purchaseAbility('${ability.id}')">
                        ${hasAbility ? 'å·²è´­ä¹°' : 'è´­ä¹°èƒ½åŠ›'}
                    </button>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // é€‰æ‹©æ€§åˆ«
        function selectGender(gender, element) {
            gameState.selectedGender = gender;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.gender-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // éšè—é”™è¯¯æç¤º
            document.getElementById('genderHint').style.display = 'none';
        }
        
        // ç¡®è®¤æ€§åˆ«
        function confirmGender() {
            if (!gameState.selectedGender) {
                document.getElementById('genderHint').style.display = 'block';
                return;
            }
            
            gameState.player.gender = gameState.selectedGender;
            switchPage('factionPage');
        }
        
        // é€‰æ‹©é˜µè¥
        function selectFaction(faction, element) {
            gameState.selectedFaction = faction;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.faction-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // éšè—é”™è¯¯æç¤º
            document.getElementById('factionHint').style.display = 'none';
        }
        
        // ç¡®è®¤é˜µè¥
        function confirmFaction() {
            if (!gameState.selectedFaction) {
                document.getElementById('factionHint').style.display = 'block';
                return;
            }
            
            gameState.player.faction = gameState.selectedFaction;
            gameState.player.isLeader = document.getElementById('willingToBeLeader').checked;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('factionBadge').textContent =
                gameState.selectedFaction === 'gang' ? 'é»‘å¸®' :
                gameState.selectedFaction === 'politician' ? 'æ”¿å®¢' : 'èµ°ç§å•†';
            
            if (gameState.player.isLeader) {
                document.getElementById('leaderBadge').style.display = 'inline-block';
                document.getElementById('factionSkillBtn').style.display = 'block';
            }
            
            switchPage('namePage');
        }
        
        // ç¡®è®¤åå­—
        function confirmName() {
            const name = document.getElementById('nameInput').value.trim();
            
            if (name.length < 2) {
                document.getElementById('nameHint').style.display = 'block';
                return;
            }
            
            gameState.player.name = name;
            document.getElementById('playerName').textContent = name;
            switchPage('avatarPage');
        }
        
        // é€‰æ‹©å¤´åƒ
        function selectAvatar(type) {
            gameState.player.avatar = type === 'default' ? 'ğŸ‘¤' : 'ğŸ–¼ï¸';
            document.getElementById('avatarPreview').textContent = gameState.player.avatar;
            document.getElementById('playerAvatar').textContent = gameState.player.avatar;
            document.getElementById('avatarHint').style.display = 'none';
        }
        
        // ç¡®è®¤å¤´åƒ
        function confirmAvatar() {
            if (!gameState.player.avatar) {
                document.getElementById('avatarHint').style.display = 'block';
                return;
            }
            
            switchPage('qrPage');
        }
        
        // ç¡®è®¤äºŒç»´ç æ‰«æ
        function confirmQRCode() {
            // éšæœºåˆ†é…æ¡Œå·
            gameState.player.tableNumber = Math.floor(Math.random() * 12) + 1;
            
            // æ˜¾ç¤ºæ¸¸æˆç•Œé¢å…ƒç´ 
            document.getElementById('statusBar').style.display = 'flex';
            document.getElementById('bottomNav').style.display = 'flex';
            
            // è¿›å…¥æ¸¸æˆå¤§å…
            switchPage('dashboardPage');
            
            // å¼€å§‹æ¸¸æˆè®¡æ—¶
            startGameTimer();
        }
        
        // æ‰«æäºŒç»´ç 
        function scanQRCode() {
            alert('è¯·æ‰«ææ¡Œé¢äºŒç»´ç ç»‘å®šæ¡Œå·');
        }
        
        // è´­ä¹°èƒ½åŠ›
        function purchaseAbility(abilityId) {
            const ability = gameState.purchasableAbilities.find(a => a.id === abilityId);
            if (!ability) return;
            
            if (gameState.player.coins < ability.price) {
                alert('é‡‘å¸ä¸è¶³ï¼Œæ— æ³•è´­ä¹°æ­¤èƒ½åŠ›');
                return;
            }
            
            // æ‰£é™¤é‡‘å¸
            gameState.player.coins -= ability.price;
            updatePlayerCoins();
            
            // æ·»åŠ èƒ½åŠ›åˆ°ç©å®¶
            gameState.player.skills.push({
                id: ability.id,
                name: ability.name,
                desc: ability.desc
            });
            
            alert(`æˆåŠŸè´­ä¹° ${ability.name} èƒ½åŠ›ï¼`);
            
            // åˆ·æ–°èƒ½åŠ›é¡µé¢
            generateAbilityList();
        }
        
        // æ›´æ–°ç©å®¶é‡‘å¸æ˜¾ç¤º
        function updatePlayerCoins() {
            document.getElementById('playerCoins').textContent = gameState.player.coins;
        }
        
        // æ›´æ–°ç©å®¶è‚¡æƒæ˜¾ç¤º
        function updatePlayerStock() {
            document.getElementById('playerStock').textContent = gameState.player.stock;
        }
        
        // æ˜¾ç¤ºæŠ€èƒ½å¼¹çª—
        function showFactionSkill() {
            const faction = gameState.player.faction;
            if (!faction) return;
            
            let title = '';
            let description = '';
            
            switch(faction) {
                case 'gang':
                    title = 'å¼ºè¡Œæ”¹å˜å¯¹å†³ç»“æœ';
                    description = 'å½“æœ¬é˜µè¥ç©å®¶å‚ä¸çš„ä¸ªäººå¯¹å†³ç»“æŸåç»“ç®—å‰ï¼Œä½ å¯ä»¥å‘åŠ¨æ­¤æŠ€èƒ½ï¼Œå¼ºè¡Œå°†ç»“æœä¿®æ”¹ä¸ºå¯¹æœ¬æ–¹æœ‰åˆ©ã€‚\n\nå‰©ä½™ä½¿ç”¨æ¬¡æ•°: 3/3';
                    break;
                case 'politician':
                    title = 'å¼ºåˆ¶æ²¡æ”¶è´¢äº§';
                    description = 'ä½ å¯ä»¥åœ¨ä»»æ„æ—¶é—´å‘åŠ¨æ­¤æŠ€èƒ½ï¼ŒæŒ‡å®šä¸€ä¸ªé˜µè¥ï¼Œå¼ºåˆ¶æ²¡æ”¶è¯¥é˜µè¥æ‰€æœ‰ç©å®¶å½“å‰è´¢äº§çš„å››åˆ†ä¹‹ä¸€ã€‚\n\nå‰©ä½™ä½¿ç”¨æ¬¡æ•°: 1/1';
                    break;
                case 'smuggler':
                    title = 'é‡‘å¸æƒ©ç½šå‡åŠ';
                    description = 'å½“æœ¬é˜µè¥ç©å®¶å› ä»»ä½•åŸå› é¢ä¸´é‡‘å¸å‡å°‘æ—¶ï¼Œä½ å¯ä»¥å‘åŠ¨æ­¤æŠ€èƒ½ï¼Œä½¿è¯¥ç©å®¶æœ¬æ¬¡åº”è¢«æ‰£é™¤çš„é‡‘å¸å‡å°‘ä¸ºåŸæ•°é¢çš„ä¸€åŠã€‚\n\nå‰©ä½™ä½¿ç”¨æ¬¡æ•°: 3/3';
                    break;
            }
            
            document.getElementById('skillTitle').textContent = title;
            document.getElementById('skillDescription').textContent = description;
            document.getElementById('skillModal').classList.add('active');
        }
        
        // å…³é—­å¼¹çª—
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // å¼€å§‹æ¸¸æˆè®¡æ—¶
        function startGameTimer() {
            const timerElement = document.getElementById('gameTimer');
            let timeLeft = 3 * 60 * 60; // 3å°æ—¶ï¼ˆç§’ï¼‰
            
            const updateTimer = () => {
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                
                timerElement.textContent =
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    endGame();
                    return;
                }
                
                timeLeft--;
                setTimeout(updateTimer, 1000);
            };
            
            updateTimer();
        }
        
        // æ¸¸æˆç»“æŸ
        function endGame() {
            alert('æ¸¸æˆç»“æŸï¼æ­£åœ¨è®¡ç®—æœ€ç»ˆç»“æœ...');
            // è¿™é‡Œæ·»åŠ ç»“ç®—é€»è¾‘
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç»‘å®š
        function initEventListeners() {
            document.getElementById('factionSkillBtn').addEventListener('click', showFactionSkill);
            document.getElementById('confirmSkillBtn').addEventListener('click', () => {
                alert('æŠ€èƒ½å‘åŠ¨æˆåŠŸï¼');
                closeModal('skillModal');
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initEventListeners();
        };
    </script>
</body>
</html>

