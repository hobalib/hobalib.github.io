var e,t,i,o,a,n,r,s;import{m as l,a as c,o as d,c as u,w as p,r as m,b as g,d as h,t as f,n as v,i as _,e as y,f as w,g as x,h as S,F as b,j as T,k as I,l as k,p as C,q as $,s as P,S as M,u as W,v as R,x as L,y as N,z as j,A as B,B as D,C as U,D as E,E as O,G as A,H,I as z,J as G,K as F,L as J}from"./index-2a5fc252.js";import{u as q,q as K,v as V,a as X,b as Y,c as Q}from"./app.ec4b7cd2.js";import{_ as Z}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as ee,a as te}from"./uv-button.a89d7810.js";import{_ as ie}from"./uv-image.5a3dfda3.js";const oe={props:{time:{type:[String,Number],default:0},format:{type:String,default:"HH:mm:ss"},autoStart:{type:Boolean,default:!0},millisecond:{type:Boolean,default:!1},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.countDown}};function ae(e,t=2){let i=`${e}`;for(;i.length<t;)i=`0${i}`;return i}const ne=1e3,re=6e4,se=36e5,le=24*se;function ce(e){return{days:Math.floor(e/le),hours:Math.floor(e%le/se),minutes:Math.floor(e%se/re),seconds:Math.floor(e%re/ne),milliseconds:Math.floor(e%ne)}}const de=Z({name:"uv-count-down",mixins:[l,c,oe],data:()=>({timer:null,timeData:ce(0),formattedTime:"0",runing:!1,endTime:0,remainTime:0}),watch:{time(e){this.reset()}},mounted(){this.init()},methods:{init(){this.reset()},start(){this.runing||(this.runing=!0,this.endTime=Date.now()+this.remainTime,this.toTick())},toTick(){this.millisecond?this.microTick():this.macroTick()},macroTick(){this.clearTimeout(),this.timer=setTimeout(()=>{const e=this.getRemainTime();var t,i;t=e,i=this.remainTime,(Math.floor(t/1e3)!==Math.floor(i/1e3)||0===e)&&this.setRemainTime(e),0!==this.remainTime&&this.macroTick()},30)},microTick(){this.clearTimeout(),this.timer=setTimeout(()=>{this.setRemainTime(this.getRemainTime()),0!==this.remainTime&&this.microTick()},50)},getRemainTime(){return Math.max(this.endTime-Date.now(),0)},setRemainTime(e){this.remainTime=e;const t=ce(e);this.$emit("change",t),this.formattedTime=function(e,t){let{days:i,hours:o,minutes:a,seconds:n,milliseconds:r}=t;return-1===e.indexOf("DD")?o+=24*i:e=e.replace("DD",ae(i)),-1===e.indexOf("HH")?a+=60*o:e=e.replace("HH",ae(o)),-1===e.indexOf("mm")?n+=60*a:e=e.replace("mm",ae(a)),-1===e.indexOf("ss")?r+=1e3*n:e=e.replace("ss",ae(n)),e.replace("SSS",ae(r,3))}(this.format,t),e<=0&&(this.pause(),this.$emit("finish"))},reset(){this.pause(),this.remainTime=this.time,this.setRemainTime(this.remainTime),this.autoStart&&this.start()},pause(){this.runing=!1,this.clearTimeout()},clearTimeout(){clearTimeout(this.timer),this.timer=null}},unmounted(){this.clearTimeout()}},[["render",function(e,t,i,o,a,n){const r=_,s=y;return d(),u(s,{class:"uv-count-down",style:v([e.$uv.addStyle(e.customStyle)])},{default:p(()=>[m(e.$slots,"default",{},()=>[g(r,{class:"uv-count-down__text"},{default:p(()=>[h(f(a.formattedTime),1)]),_:1})],!0)]),_:3},8,["style"])}],["__scopeId","data-v-6400037f"]]);const ue=Z({name:"uv-swiper-indicator",mixins:[l,c,{props:{length:{type:[String,Number],default:0},current:{type:[String,Number],default:0},indicatorActiveColor:{type:String,default:""},indicatorInactiveColor:{type:String,default:""},indicatorMode:{type:String,default:""},...null==(o=null==(i=uni.$uv)?void 0:i.props)?void 0:o.swiperIndicator}}],data:()=>({lineWidth:22}),computed:{lineStyle(){let e={};return e.width=this.$uv.addUnit(this.lineWidth),e.transform=`translateX(${this.$uv.addUnit(this.current*this.lineWidth)})`,e.backgroundColor=this.indicatorActiveColor,e},dotStyle(){return e=>{let t={};return t.backgroundColor=e===this.current?this.indicatorActiveColor:this.indicatorInactiveColor,t}}}},[["render",function(e,t,i,o,a,n){const r=y;return d(),u(r,{class:"uv-swiper-indicator"},{default:p(()=>["line"===e.indicatorMode?(d(),u(r,{key:0,class:w(["uv-swiper-indicator__wrapper",[`uv-swiper-indicator__wrapper--${e.indicatorMode}`]]),style:v({width:e.$uv.addUnit(a.lineWidth*e.length),backgroundColor:e.indicatorInactiveColor})},{default:p(()=>[g(r,{class:"uv-swiper-indicator__wrapper--line__bar",style:v([n.lineStyle])},null,8,["style"])]),_:1},8,["class","style"])):x("",!0),"dot"===e.indicatorMode?(d(),u(r,{key:1,class:"uv-swiper-indicator__wrapper"},{default:p(()=>[(d(!0),S(b,null,T(e.length,(t,i)=>(d(),u(r,{class:w(["uv-swiper-indicator__wrapper__dot",[i===e.current&&"uv-swiper-indicator__wrapper__dot--active"]]),key:i,style:v([n.dotStyle(i)])},null,8,["class","style"]))),128))]),_:1})):x("",!0)]),_:1})}],["__scopeId","data-v-abf29ab9"]]);const pe=Z({name:"uv-swiper",mixins:[l,c,{props:{list:{type:Array,default:()=>[]},indicator:{type:Boolean,default:!1},indicatorActiveColor:{type:String,default:"#fff"},indicatorInactiveColor:{type:String,default:"rgba(255, 255, 255, 0.35)"},indicatorStyle:{type:[String,Object],default:""},indicatorMode:{type:String,default:"line"},autoplay:{type:Boolean,default:!0},current:{type:[String,Number],default:0},currentItemId:{type:String,default:""},interval:{type:[String,Number],default:3e3},duration:{type:[String,Number],default:300},circular:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},previousMargin:{type:[String,Number],default:0},nextMargin:{type:[String,Number],default:0},acceleration:{type:Boolean,default:!1},displayMultipleItems:{type:Number,default:1},easingFunction:{type:String,default:"default"},keyName:{type:String,default:"url"},imgMode:{type:String,default:"aspectFill"},height:{type:[String,Number],default:130},bgColor:{type:String,default:"#f3f4f6"},radius:{type:[String,Number],default:4},loading:{type:Boolean,default:!1},showTitle:{type:Boolean,default:!1},titleStyle:{type:[Object,String],default:""},...null==(n=null==(a=uni.$uv)?void 0:a.props)?void 0:n.swiper}}],emits:["click","change"],data:()=>({currentIndex:0}),watch:{current(e,t){e!==t&&(this.currentIndex=e)}},computed:{itemStyle(){return e=>{const t={};return this.nextMargin&&this.previousMargin&&(t.borderRadius=this.$uv.addUnit(this.radius),e!==this.currentIndex&&(t.transform="scale(0.92)")),t}}},methods:{getItemType(e){return"string"==typeof e?this.$uv.test.video(this.getSource(e))?"video":"image":"object"==typeof e&&this.keyName?e.type?"image"===e.type?"image":"video"===e.type?"video":"image":this.$uv.test.video(this.getSource(e))?"video":"image":void 0},getSource(e){return"string"==typeof e?e:"object"==typeof e&&this.keyName?e[this.keyName]:(this.$uv.error("请按格式传递列表参数"),"")},change(e){const{current:t}=e.detail;this.pauseVideo(this.currentIndex),this.currentIndex=t,this.$emit("change",e.detail)},pauseVideo(e){const t=this.getSource(this.list[e]);if(this.$uv.test.video(t)){I(`video-${e}`,this).pause()}},getPoster:e=>"object"==typeof e&&e.poster?e.poster:"",clickHandler(e){this.$emit("click",e)}}},[["render",function(e,t,i,o,a,n){const r=k(C("uv-loading-icon"),ee),s=y,l=$,c=P,w=_,I=M,R=W,L=k(C("uv-swiper-indicator"),ue);return d(),u(s,{class:"uv-swiper",style:v({backgroundColor:e.bgColor,height:e.$uv.addUnit(e.height),borderRadius:e.$uv.addUnit(e.radius)})},{default:p(()=>[e.loading?(d(),u(s,{key:0,class:"uv-swiper__loading"},{default:p(()=>[g(r,{mode:"circle"})]),_:1})):(d(),u(R,{key:1,class:"uv-swiper__wrapper",style:v({height:e.$uv.addUnit(e.height),flex:1}),onChange:n.change,circular:e.circular,vertical:e.vertical,interval:e.interval,duration:e.duration,autoplay:e.autoplay,current:e.current,currentItemId:e.currentItemId,previousMargin:e.$uv.addUnit(e.previousMargin),nextMargin:e.$uv.addUnit(e.nextMargin),acceleration:e.acceleration,displayMultipleItems:e.displayMultipleItems,easingFunction:e.easingFunction},{default:p(()=>[(d(!0),S(b,null,T(e.list,(t,i)=>(d(),u(I,{class:"uv-swiper__wrapper__item",key:i},{default:p(()=>[g(s,{class:"uv-swiper__wrapper__item__wrapper",style:v([n.itemStyle(i)])},{default:p(()=>["image"===n.getItemType(t)?(d(),u(l,{key:0,class:"uv-swiper__wrapper__item__wrapper__image",src:n.getSource(t),mode:e.imgMode,onClick:e=>n.clickHandler(i),style:v({height:e.$uv.addUnit(e.height),borderRadius:e.$uv.addUnit(e.radius)})},null,8,["src","mode","onClick","style"])):x("",!0),"video"===n.getItemType(t)?(d(),u(c,{key:1,class:"uv-swiper__wrapper__item__wrapper__video",id:`video-${i}`,"enable-progress-gesture":!1,src:n.getSource(t),poster:n.getPoster(t),title:e.showTitle&&e.$uv.test.object(t)&&t.title?t.title:"",style:v({height:e.$uv.addUnit(e.height)}),controls:"",onClick:e=>n.clickHandler(i)},null,8,["id","src","poster","title","style","onClick"])):x("",!0),e.showTitle&&e.$uv.test.object(t)&&t.title?(d(),u(w,{key:2,class:"uv-swiper__wrapper__item__wrapper__title uv-line-1",style:v([e.$uv.addStyle(e.titleStyle)])},{default:p(()=>[h(f(t.title),1)]),_:2},1032,["style"])):x("",!0)]),_:2},1032,["style"])]),_:2},1024))),128))]),_:1},8,["style","onChange","circular","vertical","interval","duration","autoplay","current","currentItemId","previousMargin","nextMargin","acceleration","displayMultipleItems","easingFunction"])),g(s,{class:"uv-swiper__indicator",style:v([e.$uv.addStyle(e.indicatorStyle)])},{default:p(()=>[m(e.$slots,"indicator",{},()=>[e.loading||!e.indicator||e.showTitle?x("",!0):(d(),u(L,{key:0,indicatorActiveColor:e.indicatorActiveColor,indicatorInactiveColor:e.indicatorInactiveColor,length:e.list.length,current:a.currentIndex,indicatorMode:e.indicatorMode},null,8,["indicatorActiveColor","indicatorInactiveColor","length","current","indicatorMode"]))],!0)]),_:3},8,["style"])]),_:3},8,["style"])}],["__scopeId","data-v-401e3eb9"]]),me=R("homePage",{state:()=>({sceneId:"",swiperImg:[],videoName:"",orderId:"",payStatus:0,price:"",isPrint:""}),actions:{}}),ge=Z(L({__name:"gameSelection",props:{roomId:{default:""}},emits:["confirmSelection","countdownEnds","projectSelect"],setup(e,{expose:t,emit:i}){const o=e,a=me(),n=q(),r={borderRadius:"40rpx",paddingLeft:"40rpx",paddingRight:"40rpx",width:"560rpx"},s={fontSize:"36rpx"},l={bottom:"10rpx"},c=N(0),m=j(),w=N([{imagePath:""},{imagePath:""},{imagePath:""}]),S=N(!0);const b=i;function T(){console.log(D("homePage.countdownEndText")),b("countdownEnds")}function I(){var e;null==(e=m.value)||e.reset(),b("confirmSelection",c.value)}function $(e){const t=e.current;c.value=t,console.log("index::",t),a.sceneId=w.value[t].scene_id,a.price=w.value[t].price,a.payStatus=w.value[t].status,a.isPrint=w.value[t].is_print,n.swiperBg=w.value[t].imagePath,b("projectSelect")}return t({init:async()=>{var e;await async function(){try{const e=(await K(o.roomId)).data;w.value=e.map(e=>({...e,imagePath:e.image?e.image[0]:""})),a.sceneId=e[0].scene_id,a.price=e[0].price,a.payStatus=e[0].status,a.isPrint=e[0].is_print,n.swiperBg=e[0].image?e[0].image[0]:"",console.log("_data[0].image::",e[0].image?e[0].image[0]:"")}catch(e){console.log(e)}finally{S.value=!1}}(),null==(e=m.value)||e.start()},closeCountDown:()=>{var e;null==(e=m.value)||e.reset()}}),(e,t)=>{const i=y,o=_,a=k(C("uv-count-down"),de),b=k(C("uv-swiper"),pe),P=k(C("uv-button"),te);return d(),u(i,{class:"itcode-flex-row itcode-items-center game-selection-container"},{default:p(()=>[g(i,{class:"fictitious-bg",style:v({backgroundImage:`url(${B(n).swiperBg})`,backgroundRepeat:"no-repeat",backgroundSize:"auto 100%",filter:"brightness(80%) blur(15px)"})},null,8,["style"]),g(i,{class:"itcode-flex-col gsc-wapper"},{default:p(()=>[g(i,{class:"itcode-flex-col itcode-justify-center itcode-items-center _title"},{default:p(()=>[g(i,{class:"nspan"},{default:p(()=>[h(f(e.$t("homePage.selectMoviePrompt")),1)]),_:1}),g(i,{class:"itcode-flex-row djs-span"},{default:p(()=>[g(o,null,{default:p(()=>[h(f(e.$t("homePage.timeLimitPrefix")),1)]),_:1}),g(a,{ref_key:"countDownRef",ref:m,autoStart:!1,time:4e4,format:"ss",onFinish:T},null,512),g(o,null,{default:p(()=>[h(f(e.$t("homePage.timeLimitSuffix")),1)]),_:1})]),_:1})]),_:1}),g(i,{class:"itcode-flex-row itcode-justify-center game-swiper"},{default:p(()=>[g(b,{style:{width:"100%",height:"100%","padding-bottom":"100rpx"},list:B(w),current:B(c),previousMargin:"85",nextMargin:"85",indicator:!1,circular:"",autoplay:!1,radius:"5",bgColor:"transparent",height:"100%",indicatorMode:"dot",keyName:"imagePath",indicatorStyle:l,loading:B(S),onChange:$},{indicator:p(()=>[B(S)?x("",!0):(d(),u(i,{key:0,class:"custom-indicator"},{default:p(()=>[h(f(B(c)+1)+" / "+f(B(w).length),1)]),_:1}))]),_:1},8,["list","current","loading"])]),_:1}),g(i,{class:"itcode-flex-row itcode-justify-center _buttons"},{default:p(()=>[g(P,{disabled:B(S),type:"primary",text:B(D)("homePage.confirmSelectionText"),"custom-style":r,customTextStyle:s,onClick:I},null,8,["disabled","text"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-da9eed96"]]),he=Z(L({__name:"startNow",emits:["startGame"],setup(e,{emit:t}){const i=q(),o={borderRadius:"40rpx",paddingLeft:"40rpx",paddingRight:"40rpx",backgroundColor:"transparent",border:"none"},a={fontSize:"50rpx",fontFamily:"YouSheBiaoTiHei-2"},n=t;function r(){n("startGame")}return(e,t)=>{const n=y,s=k(C("uv-button"),te);return d(),u(n,{class:"itcode-flex-row itcode-items-center start-now-container"},{default:p(()=>[g(n,{class:"fictitious-bg",style:v({backgroundImage:`url(${B(i).swiperBg})`,backgroundRepeat:"no-repeat",backgroundSize:"auto 100%",filter:"brightness(80%) blur(15px)"})},null,8,["style"]),g(n,{class:"itcode-flex-col itcode-items-center snc-wapper"},{default:p(()=>[g(n,{class:"snc-icon"}),g(n,{class:"_title"},{default:p(()=>[g(n,null,{default:p(()=>[h(f(e.$t("homePage.startNowMessage1")),1)]),_:1}),g(n,null,{default:p(()=>[h(f(e.$t("homePage.startNowMessage2")),1)]),_:1})]),_:1}),g(n,{class:"itcode-flex-row itcode-justify-center _buttons"},{default:p(()=>[g(s,{type:"primary",text:B(D)("homePage.startNowButtonText"),"custom-style":o,customTextStyle:a,onClick:r},null,8,["text"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-0b8dee0b"]]),fe=Z(L({__name:"gameInProgress",emits:["changeIndex"],setup(e,{emit:t}){const i=q();function o(){}return(e,t)=>{const a=y,n=k(C("uv-image"),ie);return d(),u(a,{class:"itcode-flex-row itcode-items-center game-in-progress-container"},{default:p(()=>[g(a,{class:"fictitious-bg",style:v({backgroundImage:`url(${B(i).swiperBg})`,backgroundRepeat:"no-repeat",backgroundSize:"auto 100%",filter:"brightness(80%) blur(20px)"})},null,8,["style"]),g(a,{class:"itcode-flex-col itcode-items-center gipc-wapper"},{default:p(()=>[g(a,{class:"_title",onClick:o},{default:p(()=>[h(f(e.$t("homePage.movieInProgressTitle")),1)]),_:1}),g(a,{class:"card-image",style:v({backgroundImage:`url(${B(i).swiperBg})`,backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"})},{default:p(()=>[g(a,{class:"show-postcard"},{default:p(()=>[g(a,{class:"itcode-flex-row itcode-items-center ewm-text"},{default:p(()=>[g(n,{src:"//aifsh.hobalab.com/box/qrcode.png",width:"108rpx",height:"108rpx"}),g(a,{class:"_text"},{default:p(()=>[g(a,null,{default:p(()=>[h(f(e.$t("homePage.scanQRCode")),1)]),_:1}),g(a,null,{default:p(()=>[h(f(e.$t("homePage.downloadYourVideo")),1)]),_:1})]),_:1})]),_:1})]),_:1}),g(a,{class:"reminder-information"},{default:p(()=>[h(f(e.$t("homePage.posterReminder")),1)]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-17aa5731"]]),ve={props:{indicatorWidth:{type:[String,Number],default:50},indicatorBarWidth:{type:[String,Number],default:20},indicator:{type:Boolean,default:!0},indicatorColor:{type:String,default:"#f2f2f2"},indicatorActiveColor:{type:String,default:"#3c9cff"},indicatorStyle:{type:[String,Object],default:""},...null==(s=null==(r=uni.$uv)?void 0:r.props)?void 0:s.scrollList}};function _e(e,t,i){e.selectComponent(".uv-scroll-list__indicator__line__bar")&&e.selectComponent(".uv-scroll-list__indicator__line__bar").setStyle({transform:"rpx"==i?"translateX("+t+"rpx)":"translateX("+t+"px)"})}const ye={scroll:function(e,t){var i=e.detail,o=i.scrollWidth,a=i.scrollLeft,n=e.currentTarget.dataset;_e(t,a/(o-(n.scrollWidth||n.scrollwidth||0))*((n.indicatorWidth||n.indicatorwidth||0)-(n.barWidth||n.barwidth||0)),n.unit)},scrolltolower:function(e,t){t.callMethod("scrollEvent","right");var i=e.currentTarget.dataset;_e(t,(i.indicatorWidth||i.indicatorwidth||0)-(i.barWidth||i.barwidth||0),i.unit)},scrolltoupper:function(e,t){var i=e.currentTarget.dataset;t.callMethod("scrollEvent","left"),_e(t,0,i.unit)}},we=e=>{e.$wxs||(e.$wxs=[]),e.$wxs.push("wxs"),e.mixins||(e.mixins=[]),e.mixins.push({beforeCreate(){this.wxs=ye}})},xe={name:"uv-scroll-list",mixins:[l,c,ve],data:()=>({scrollInfo:{scrollLeft:0,scrollWidth:0},scrollWidth:0}),computed:{barStyle(){const e={};return e.width=this.$uv.addUnit(this.indicatorBarWidth),e.backgroundColor=this.indicatorActiveColor,e},lineStyle(){const e={};return e.width=this.$uv.addUnit(this.indicatorWidth),e.backgroundColor=this.indicatorColor,e}},mounted(){this.init()},methods:{init(){this.getComponentWidth()},scrollEvent(e){this.$emit(e)},async getComponentWidth(){await this.$uv.sleep(30),this.$uvGetRect(".uv-scroll-list").then(e=>{this.scrollWidth=e.width})}}};we(xe);const Se=Z(xe,[["render",function(e,t,i,o,a,n){const r=y,s=U;return d(),u(r,{class:"uv-scroll-list",ref:"uv-scroll-list"},{default:p(()=>[g(s,{class:"uv-scroll-list__scroll-view","scroll-x":"",onScroll:e.wxs.scroll,onScrolltoupper:e.wxs.scrolltoupper,onScrolltolower:e.wxs.scrolltolower,"data-scrollWidth":a.scrollWidth,"data-barWidth":e.$uv.getPx(e.indicatorBarWidth),"data-indicatorWidth":e.$uv.getPx(e.indicatorWidth),"show-scrollbar":!1,"upper-threshold":0,"lower-threshold":0,"data-unit":e.$uv.unit},{default:p(()=>[g(r,{class:"uv-scroll-list__scroll-view__content"},{default:p(()=>[m(e.$slots,"default",{},void 0,!0)]),_:3})]),_:3},8,["onScroll","onScrolltoupper","onScrolltolower","data-scrollWidth","data-barWidth","data-indicatorWidth","data-unit"]),e.indicator?(d(),u(r,{key:0,class:"uv-scroll-list__indicator",style:v([e.$uv.addStyle(e.indicatorStyle)])},{default:p(()=>[g(r,{class:"uv-scroll-list__indicator__line",style:v([n.lineStyle])},{default:p(()=>[g(r,{class:"uv-scroll-list__indicator__line__bar",style:v([n.barStyle]),ref:"uv-scroll-list__indicator__line__bar"},null,8,["style"])]),_:1},8,["style"])]),_:1},8,["style"])):(d(),u(r,{key:1,class:"uv-scroll-list__indicator__line__bar"}))]),_:3},512)}],["__scopeId","data-v-3bc5da8f"]]),be=Z(L({__name:"excitingMoments",emits:["endTheGame"],setup(e,{emit:t}){const i=q(),o={borderRadius:"40rpx",paddingLeft:"200rpx",paddingRight:"200rpx"},a={fontSize:"36rpx",fontFamily:"YouSheBiaoTiHei-2"},n=me(),r=N(0);function s(e){const{current:t}=e;r.value=t}const l=t;function c(){l("endTheGame",-1)}return(e,t)=>{const l=y,m=k(C("uv-swiper"),pe),_=k(C("uv-image"),ie),x=k(C("uv-scroll-list"),Se),I=k(C("uv-button"),te);return d(),u(l,{class:"itcode-flex-row itcode-items-center exciting-moments-container"},{default:p(()=>[g(l,{class:"fictitious-bg",style:v({backgroundImage:`url(${B(i).swiperBg})`,backgroundRepeat:"no-repeat",backgroundSize:"auto 100%",filter:"brightness(80%) blur(20px)"})},null,8,["style"]),g(l,{class:"itcode-flex-col itcode-items-center emc-wapper"},{default:p(()=>[g(l,{class:"_title"},{default:p(()=>[h(f(e.$t("homePage.excitingMomentsTitle")),1)]),_:1}),g(l,{class:"itcode-flex-col itcode-justify-center itcode-items-center image-swiper"},{default:p(()=>[g(m,{style:{width:"100%",height:"350rpx","padding-bottom":"30rpx"},list:B(n).swiperImg,indicator:!1,circular:"",autoplay:!1,radius:"5",bgColor:"transparent",height:"100%",current:B(r),onChange:s},null,8,["list","current"]),g(x,{style:{width:"100%",height:"100%","padding-bottom":"50rpx"},indicator:!1,indicatorColor:"#fff0f0",indicatorActiveColor:"#f56c6c"},{default:p(()=>[(d(!0),S(b,null,T(B(n).swiperImg,(e,t)=>(d(),u(l,{key:t,class:w(["image-item",{"active-item":t==B(r)}]),onClick:e=>s({current:t})},{default:p(()=>[g(_,{src:e,width:"80px",height:"45px",radius:"5"},null,8,["src"])]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),g(l,{class:"itcode-flex-row itcode-justify-center _buttons"},{default:p(()=>[g(I,{type:"primary",text:B(D)("homePage.endMovieText"),"custom-style":o,customTextStyle:a,onClick:c},null,8,["text"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-3091f9c8"]]);const Te=Z(L({__name:"index",setup(e){const t=q(),i=me(),{loadSocket:o,socketTask:a,sendMessage:n,socketTaskClose:r}=function(){const e=N(null),t=q();function i(){var t;try{console.log("SOCKET关闭"),null==(t=e.value)||t.close({}),e.value=null}catch(i){console.log(i)}}return E(()=>{i()}),{socketTask:e,loadSocket:function(i,o){return new Promise((a,n)=>{let r=O({url:`wss://aifs.hobalab.com/ws/room/${i}/`,header:{"content-type":"application/json"},method:"GET",protocols:[],complete:()=>{}});null==r||r.onOpen(e=>{console.log(`WebSocket连接已打开！连接成功信息：${JSON.stringify(e)}`),r.onMessage(e=>{let t=(null==e?void 0:e.data)&&JSON.parse(null==e?void 0:e.data);["ue_applet_joinRoom","ue_applet_wait","ue_applet_Gaming"].includes(null==t?void 0:t.api)&&(console.log("UE响应数据：",t),o&&o(t))}),a(!0)}),r.onError(e=>{console.log(`通信出错！=======${JSON.stringify(e)}`),A({title:"提示",content:"服务通信错误！请联系管理员",confirmText:"前往作品集",confirmColor:t.themeColor,showCancel:!1,success:function(e){e.confirm&&H({url:"/pages/gameList/index"})}}),n()}),e.value=r})},sendMessage:function(t){const i={api:t.api?t.api:"applet_ue_joinRoom",...t};return new Promise((t,o)=>{var a;null==(a=e.value)||a.send({data:JSON.stringify(i),success:()=>{console.log("发送成功",i),t(!0)},fail:e=>{console.log(`发送失败！${e.errMsg}`),o()}})})},socketTaskClose:i}}(),s=j(),l=N(0),c=N(0),m=N(""),h=N();async function f(){try{if(X().loading(D("homePage.movieInitializing")),!t.uuidTimeStamp){await o(m.value,C);const e=`${t.openId}_${m.value}_${(new Date).getTime()}`;return t.uuidTimeStamp=e,void F(async()=>{var o;await(null==(o=s.value)?void 0:o.init()),await n({openid:t.openId,orderid:"",step:0,phone:"",scene:i.sceneId,uuidStr:e}),h.value=setTimeout(()=>{var e;null==(e=s.value)||e.closeCountDown(),t.uuidTimeStamp="",r(),X().hideLoading();const i=D("homePage.tip"),o=D("homePage.platformNotReady"),a=D("homePage.goToWorks");A({title:i,content:o,confirmText:a,confirmColor:t.themeColor,showCancel:!1,success:function(e){e.confirm&&H({url:"/pages/gameList/index"})}})},1e3)})}const e=await Y(m.value,t.openId,t.uuidTimeStamp),{step:a,orderid:c,timestamp:d,img:u,videoname:p}=e.data;if(!a)return void _();switch(`${a}`){case"1":await o(m.value,C),F(async()=>{var e;await(null==(e=s.value)?void 0:e.init()),await n({openid:t.openId,orderid:"",step:0,phone:"",scene:i.sceneId,uuidStr:t.uuidTimeStamp})});break;case"2":l.value=1,await o(m.value,C);break;case"3":l.value=2,await o(m.value,C),X().hideLoading();break;case"4":case"5":case"6":_()}}catch(e){X().hideLoading()}}function _(){localStorage.setItem("resetLoad","1"),t.uuidTimeStamp="",X().loading(D("homePage.loadingText"),!0),setTimeout(()=>{location.reload()})}async function w(){await n({step:"2",orderid:i.orderId,openid:t.openId,phone:"",scene:i.sceneId})}async function S(){try{X().loading(D("homePage.loadingText"),!0);const e=await Q(m.value,i.sceneId,t.openId,i.price),o=e.data;i.orderId=o.order,console.log("订单信息：：",e);let a=o.order;X().loading(D("homePage.sceneBuilding"),!0),await n({step:"3",orderid:a,openid:t.openId,phone:"",scene:i.sceneId})}catch(e){r()}}async function b(){X().loading(D("homePage.sceneLoading"),!0),await n({openid:t.openId,step:4,orderid:i.orderId,phone:"",scene:i.sceneId})}async function T(){H({url:"/pages/gameList/index"})}function I(){t.uuidTimeStamp="",r();const e=D("homePage.tip"),i=D("homePage.timeoutMessage"),o=D("homePage.goToWorks");A({title:e,content:i,confirmText:o,confirmColor:t.themeColor,showCancel:!1,success:function(e){e.confirm&&H({url:"/pages/gameList/index"})}})}z(async e=>{var i;let o=e.room_id;if(!o){null==(i=s.value)||i.closeCountDown();const e=D("homePage.tip"),o=D("homePage.invalidQRCode"),a=D("homePage.goToWorks");return void A({title:e,content:o,confirmText:a,confirmColor:t.themeColor,showCancel:!1,success:function(e){e.confirm&&H({url:"/pages/gameList/index"})}})}let a=e.sign;if("1"==localStorage.getItem("resetLoad"))return m.value=o,await t.appLogin(),f(),void localStorage.removeItem("resetLoad");V(o,a).then(async e=>{e.data.status?(m.value=o,await t.appLogin(),f()):H({url:"/pages/gameList/index"})})}),G(async()=>{console.log(11)});const k=N(!1);function C(e){var o,a;if("ue_applet_joinRoom"==e.api){if(!k.value)if(0==e.state){if(e.openid!=t.openId)return;k.value=!0}else if(1==e.state&&e.openid!=t.openId){null==(o=s.value)||o.closeCountDown(),t.uuidTimeStamp="",r(),X().hideLoading();const e=D("homePage.tip"),i=D("homePage.setupInProgress"),a=D("homePage.goToWorks");A({title:e,content:i,confirmText:a,confirmColor:t.themeColor,showCancel:!1,success:function(e){e.confirm&&H({url:"/pages/gameList/index"})}})}if(null==e?void 0:e.order){if(e.openid!=t.openId)return;i.orderId=e.order,l.value=4}if(null==e?void 0:e.img){if(e.openid!=t.openId)return;console.log("接受图片：",e.img),i.swiperImg=e.img}switch(null==e?void 0:e.msg){case"ueopen":h.value&&clearTimeout(h.value);break;case"gameover":if(e.openid!=t.openId)return;i.orderId=null==e?void 0:e.order_code,i.videoName=null==e?void 0:e.videoname,H({url:"/pages/gameList/index"});break;case"TimeOut":{if(e.openid!=t.openId)return;null==(a=s.value)||a.closeCountDown(),r(),t.uuidTimeStamp="";const i=D("homePage.tip"),o=D("homePage.selectionTimeout"),n=D("homePage.iKnow");A({title:i,content:o,confirmText:n,confirmColor:t.themeColor,showCancel:!1,success:function(e){e.confirm&&H({url:"/pages/gameList/index"})}});break}}}if(2==(null==e?void 0:e.step)){if(e.openid!=t.openId)return;console.log("场景加载完成 ==进入电影回调！"),l.value=1,X().hideLoading()}if(3==(null==e?void 0:e.step)){if(e.openid!=t.openId)return;console.log("场景开始 ==UE马上电影回调！"),l.value=2,X().hideLoading()}}function $(e){console.log(l.value,e),l.value=e.detail.current}return(e,i)=>{const o=y,a=M,n=W;return d(),u(o,{class:"home-page-container",style:v({"--itcode-primary-color":B(t).themeColor})},{default:p(()=>[B(t).swiperBg?x("",!0):(d(),u(o,{key:0,class:"seize-aseat-box"})),g(n,{class:"swiper-box",duration:B(c),current:B(l),onAnimationfinish:$},{default:p(()=>[g(a,{class:"swiper-item",onTouchmove:i[0]||(i[0]=J(()=>{},["stop"]))},{default:p(()=>[g(ge,{ref_key:"gameSelectionRef",ref:s,onConfirmSelection:S,onProjectSelect:w,onCountdownEnds:I,roomId:B(m)},null,8,["roomId"])]),_:1}),g(a,{class:"swiper-item",onTouchmove:i[1]||(i[1]=J(()=>{},["stop"]))},{default:p(()=>[g(he,{onStartGame:b})]),_:1}),g(a,{class:"swiper-item",onTouchmove:i[2]||(i[2]=J(()=>{},["stop"]))},{default:p(()=>[g(fe)]),_:1}),g(a,{class:"swiper-item",onTouchmove:i[3]||(i[3]=J(()=>{},["stop"]))},{default:p(()=>[g(be,{onEndTheGame:T})]),_:1})]),_:1},8,["duration","current"])]),_:1},8,["style"])}}}),[["__scopeId","data-v-1437a676"]]);export{Te as default};
